<script>
const ENDPOINT = "PASTE_APPS_SCRIPT_WEB_APP_URL_HERE";

// Helper POST JSON
async function api(action, payload={}){
  const res = await fetch(ENDPOINT, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action, ...payload}) });
  return res.json();
}

// Host create room
async function createRoom(){
  const r = await api('createRoom', {});
  // simpan hostKey untuk host sahaja
  localStorage.setItem('roomCode', r.roomCode);
  localStorage.setItem('hostKey', r.hostKey);
  console.log('room', r);
}

// Player join
async function join(name, roomCode){
  const r = await api('join', {roomCode, name});
  localStorage.setItem('playerId', r.playerId);
  console.log('joined', r);
}

// Host start
async function startGame(){
  const roomCode = localStorage.getItem('roomCode');
  const hostKey = localStorage.getItem('hostKey');
  const r = await api('start', {roomCode, hostKey});
  console.log('started', r);
}

// Poll state (setInterval)
let pollTimer=null;
function beginPoll(roomCode){
  if(pollTimer) clearInterval(pollTimer);
  pollTimer=setInterval(async ()=>{
    const r = await api('getState', {roomCode});
    if(r.ok){
      // r.state.room.status, r.state.players = [{name, role, alive, ...}]
      // Penting: role HANYA paparkan kepada player tertentu (di client) kalau anda mahu privacy.
      // Cara: simpankan role hanya di server & beri kepada client ikut playerId (perlu tambah endpoint khusus).
      renderState(r.state);
    }
  }, 1200); // 1.2s
}

// Contoh update (host bunuh player / tukar fasa)
async function setDay(){ await api('update', {roomCode: localStorage.getItem('roomCode'), hostKey: localStorage.getItem('hostKey'), status:'day'}); }
async function kill(pid){ await api('update', {roomCode: localStorage.getItem('roomCode'), hostKey: localStorage.getItem('hostKey'), killPlayerId: pid}); }

function renderState(state){
  console.log(state);
  // TODO: kemaskini UI â€” senarai pemain, hidup/mati, status day/night, dsb
}
</script>
